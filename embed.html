<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex, nofollow">
<title>GCP Monitor Widget</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:transparent;font-family:'Segoe UI',system-ui,sans-serif;display:flex;align-items:center;justify-content:center;min-height:100vh;overflow:hidden}
/* Size variants via URL params: ?size=small|medium|large */
.widget{text-align:center;text-decoration:none;color:inherit;display:block;cursor:pointer}
.widget:hover .dot{transform:scale(1.08)}

/* The dot */
.dot{
  width:48px;height:48px;border-radius:50%;
  margin:0 auto 6px;
  background:radial-gradient(circle at 35% 35%, rgba(255,255,255,0.15) 0%, transparent 60%);
  box-shadow:0 0 20px var(--glow),0 0 6px var(--glow),inset 0 0 12px rgba(0,0,0,0.2);
  transition:background-color 0.8s,box-shadow 0.8s,transform 0.3s;
  position:relative;
}
.dot::after{
  content:'';position:absolute;inset:3px;border-radius:50%;
  background:radial-gradient(circle at 40% 35%, rgba(255,255,255,0.2) 0%, transparent 50%);
}

.label{font-size:10px;color:#8492a6;letter-spacing:0.5px}
.value{font-family:'SF Mono','Cascadia Mono',monospace;font-size:11px;font-weight:700;color:#e2e8f0;margin-top:1px}
.credit{font-size:8px;color:#4a5568;margin-top:4px;text-decoration:none}
.credit:hover{color:#22d3ee}

/* Medium variant */
.widget.medium .dot{width:64px;height:64px}
.widget.medium .label{font-size:11px}
.widget.medium .value{font-size:13px}

/* Large variant */
.widget.large .dot{width:80px;height:80px;margin-bottom:8px}
.widget.large .label{font-size:12px}
.widget.large .value{font-size:15px}
.widget.large .credit{font-size:9px}

/* Minimal variant - just the dot */
.widget.minimal .label,.widget.minimal .value,.widget.minimal .credit{display:none}
.widget.minimal .dot{margin:0}

/* Dark background variant */
body.dark{background:#080b14}

/* Pulse animation */
@keyframes pulse{0%,100%{box-shadow:0 0 20px var(--glow),0 0 6px var(--glow),inset 0 0 12px rgba(0,0,0,0.2)}50%{box-shadow:0 0 30px var(--glow),0 0 12px var(--glow),inset 0 0 12px rgba(0,0,0,0.2)}}
.dot.active{animation:pulse 3s ease-in-out infinite}
</style>
</head>
<body>

<a class="widget" id="widget" href="https://siamsnus.github.io/gcp-monitor/" target="_blank" title="Global Consciousness Monitor">
  <div class="dot" id="dot"></div>
  <div class="label">GCP Network</div>
  <div class="value" id="widgetValue">—</div>
  <div class="credit">gcpmonitor.com</div>
</a>

<script>
// Parse URL params
var params = new URLSearchParams(window.location.search);
var size = params.get('size') || 'small'; // small, medium, large, minimal
var theme = params.get('theme') || 'transparent'; // transparent, dark
var showPulse = params.get('pulse') !== 'false';

if (size !== 'small') document.getElementById('widget').classList.add(size);
if (theme === 'dark') document.body.classList.add('dark');

function getColor(variance) {
  if (variance >= 1.3) return { bg: '#f87171', glow: 'rgba(248,113,113,0.5)', status: 'Very High' };
  if (variance >= 1.15) return { bg: '#fbbf24', glow: 'rgba(251,191,36,0.4)', status: 'High' };
  if (variance >= 1.05) return { bg: '#34d399', glow: 'rgba(52,211,153,0.4)', status: 'Elevated' };
  return { bg: '#60a5fa', glow: 'rgba(96,165,250,0.35)', status: 'Normal' };
}

async function updateWidget() {
  try {
    // Try fetching from our data feed
    var base = 'https://siamsnus.github.io/gcp-monitor/';
    var resp = await fetch(base + 'data/gcp-current.json?t=' + Date.now());
    var data = await resp.json();
    var v = data.network.network_variance;
    var c = getColor(v);
    var dot = document.getElementById('dot');
    dot.style.backgroundColor = c.bg;
    dot.style.setProperty('--glow', c.glow);
    if (showPulse && v >= 1.05) dot.classList.add('active');
    else dot.classList.remove('active');
    document.getElementById('widgetValue').textContent = v.toFixed(2) + ' · ' + c.status;
  } catch (e) {
    // Fallback: show neutral
    var dot = document.getElementById('dot');
    dot.style.backgroundColor = '#60a5fa';
    dot.style.setProperty('--glow', 'rgba(96,165,250,0.35)');
    document.getElementById('widgetValue').textContent = 'Loading...';
  }
}

updateWidget();
setInterval(updateWidget, 600000); // Refresh every 10 min
</script>
</body>
</html>
